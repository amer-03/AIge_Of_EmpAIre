Lean: 50 foods, 200 woods, 50 golds, town center, 3 villageois
Mean: 2000 foods, 2000 woods, 2000 golds, town center, 3 villageois
Marines: 20 000 foods, 20 000 woods, 20 000 golds, 3 town centers, 15 villagers, 2 barracks, 2 stables, 2 archery ranges

Lean stratégie économique :
1ère étape : Début de la partie
-   1 villageois construit une Farm immédiatement (60 bois).
-   Les 2 autres villageois récoltent du bois dans une forêt proche pour permettre la construction d’autres Farms.
-   Construire une maison (25 bois) dès que possible pour augmenter la capacité de population.
-   Produire 3 nouveaux villageois (150 nourriture) dès que la Farm produit suffisamment de ressources.
-   Répartition initiale des villageois après ces étapes :
        3 villageois pour le bois.
        1 villageois sur la Farm pour récolter de la nourriture.
2ème étape : Expansion économique (priorité Farms et production continue)
-   Construire 2 Farms supplémentaires dès que 120 bois sont récoltés pour accélérer la production de nourriture.
-   Produire des villageois en continu : le Town Center doit rester actif.
-   Répartir les nouveaux villageois comme suit :
        2 sur chaque Farm.
        Les autres sur le bois pour maintenir la construction de nouvelles Farms et d’autres bâtiments.
-   Après avoir atteint une dizaine de villageois, répartir les ressources :
        5 villageois sur les Farms.
        4 villageois pour récolter du bois.
        1 villageois pour commencer à récolter de l’or.
3ème étape : Transition militaire et défense
-   Construire une Barracks (175 bois) et former 2-3 Swordsmen pour se protéger contre des attaques précoces.
-   Construire une Stable (175 bois) pour commencer à former des Horsemen.
-   Augmenter les Farms à 6-8 pour garantir une production constante de nourriture.
-   Répartir les ressources :
        8 villageois sur les Farms (nourriture).
        5 villageois sur le bois.
        3 villageois sur l’or.
-   Construire une Archery Range (175 bois) pour diversifier la production militaire.
4ème étape : Préparation à l’offensive
-   Continuer à produire des villageois pour maintenir un rythme économique.
-   Répartition idéale des ressources :
        40% des villageois sur les Farms pour soutenir une production constante.
        30% sur le bois pour les bâtiments et les Archers.
        30% sur l’or pour les unités avancées.
-   Former une armée mixte :
        10-12 Swordsmen pour la ligne de front.
        8-10 Archers pour le soutien à distance.
        6-8 Horsemen pour des raids rapides.
-   Construire un deuxième Town Center près d’une nouvelle source de bois ou d’or pour sécuriser l’économie à long terme.
A terme distribution idéale des ressources :
-	40% pour la nourriture (fermes)
-	30% pour le bois (bat et archers)
-	30% pour l’or (unités avancées)



Lean stratégie agressive :
1ère étape :
-	Former un villageois avec les 50 de nourritures puis répartir 2 villageois au bois et 2 à la nourriture
-   Contruire une maison avec les 25 de bois
-   Construire une barracks une fois les 175 de bois collectés
-   Dès que c'est possible former des swordsmen
2ème étape :
-   Entraîner 3 swordsmen (50 nourritures + 20 or)
-   Une fois les swordsmen prêts, envoyez les directement harceler l'économie adverse
-   Cibler aussi les villageois ennemis pour ralentir leur production
-   Former ensuite 5 villageois en plus de sorte à en mettre 4 villageois pour la nourriture, 3 villageois pour le bois, 2 villageois
3ème étape :
-   Construire des bâtiments militaires supplémentaires, construire une stable et une archery range, faire une dizaine d'archers puis une dizaine de horsemen
-   Continuer à former des unités et maintenir la production militaire
-   4-5 swordsmen en première ligne / 2-3 horsemen pour les raids rapides / 2-3 archers pour le soutien à distance
-   Construire un keep pour protéger votre économie si l'adversaire tente une contre-attaque / positioner près des villageois
4ème étape :
-   Continuer de diversifier l'armée, ajouter des horsmen et des archers
-   Raid les zones économiques ennemies pour détruire leurs récolteurs
-   Attaquer leurs bâtiments clés comme le town center ou les camps pour limiter leur croissance
-   Utiliser les villageois pour construire un deuxième town center près de nouvelles ressources, afin de sécuriser une économie à long terme
A terme distribution idéale des resssources :
-   40% de nourriture pour la production de hrosemen et swordsmen
-   30% de bois pour les bâtiments, archers, maisons
-   30% pour maintenir les coûts des unités militaires

Lean stratégie défensive :
1ère étape :
-   Former un villageois avec les 50 de nourritures pour passer à 4 villageois
-   Répartir les villageois (2 au bois et 2 à la nourriture)
-   Construire une maison
-   Construire un camp dès que possible près d'une forêt pour optimiser la collecte de bois
2ème étape :
-   Former 4 villageois supplémentaires (2 pour la nourriture et 2 pour l'or)
-   Construire une barracks, entrainer 2-3 swordsmen pour une défense de base, positionner ces unités près des villageois
-   Construire un keep près du town center
-   POsitionner idalement le keep pour couvrir les villageois et empêcher les raids ennemis
3ème étape :
-   Ajouter 2-3 archers pour attaquer à distance et renforcer votre défense, maintenir une petite force de swordsmen en cas de percée ennemie
-   Construire un deuxième keep si nécessaire, pour protéger les ressources plus éloignées
-   Poursuivre la collecte des ressources avec des répartition optimale (4 villageois à la nourriture, 4 au bois et 3 à l'or
4ème étape :
-   Construire un deuxième town center près de nouvelles ressources mais dans une zone protégée par un keep
-   Renforcer vos défenses avec des unités mixtes (former des archers pour une couverture à distance
-   Garder une armée de 5 swordsmen, 3 horsemen et 5 archers en réserve pour défendre la base
-   Construire plus de keeps et de batîments défensifs autour des points stratégiques (or éloigné, deuxième town center, entrées vers la base)
A terme distribution ideale des ressources :
-   40% de nourriture, pour continuer à produire des unités militaires (swordsmen, horsemen)
-   30% de bois, pour keeps, archers maisons et potentiellement des farms si la nourriture naturelle est épuisée
-   30% d'or, pour maintenir les coûts des unités militaires et des bâtiments comme les keeps


from Units import Unit
from Buildings import Buildings
from Recolte_ressources import Recolte_ressources

class AI_Eco:
    def __init__(self, player_id, game):
        self.player_id = f"joueur_{player_id}"
        self.game = game
        self.state = "BOOM"
        self.min_villagers = 10
        self.min_soldiers = 5

    def update(self):
        if self.is_under_attack():
            self.state = "DEFEND"

        if self.state == "BOOM":
            self.execute_boom_strategy()
        else:
            self.execute_defense_strategy()

    def is_under_attack(self):
        for pos, data in self.game.tiles.items():
            if 'unites' in data:
                for player, units in data['unites'].items():
                    if player != self.player_id and any(unit in ['s', 'a'] for unit in units.keys()):
                        return True
        return False

    def execute_boom_strategy(self):
        # Create villagers continuously
        self.create_unit('v')

        # Create Town Centers continuously
        self.build_towncenter()

    def execute_defense_strategy(self):
        # Create military units
        current_soldiers = (self.game.compteur[self.player_id]['unites'].get('s', 0) +
                          self.game.compteur[self.player_id]['unites'].get('a', 0))
        if current_soldiers < self.min_soldiers:
            self.create_unit('s')

    def create_unit(self, unit_type):
        costs = self.game.unit.units_dict[unit_type]['cout']
        resources = self.game.compteur[self.player_id]['ressources']

        if (resources['W'] >= costs['Wood'] and
            resources['G'] >= costs['Gold'] and
            resources['f'] >= costs['Food']):
            self.game.unit.creation_unite(unit_type, self.player_id)

    def assign_villagers(self):
        for pos, data in self.game.tiles.items():
            if 'unites' in data and self.player_id in data['unites']:
                villagers = data['unites'][self.player_id].get('v', {})
                for v_id, v_data in villagers.items():
                    if v_data['Status'] == 'libre':
                        self.assign_villager_to_resource(v_id)

    def assign_villager_to_resource(self, villager_id):
        resources = ['W', 'G', 'f']
        for resource in resources:
            pos = self.game.recolte.trouver_plus_proche_ressource(
                self.player_id, 'v', villager_id, resource
            )
            if pos:
                self.game.unit.deplacer_unite(self.player_id, 'v', villager_id, pos)
                break

    def build_towncenter(self):
        costs = self.game.buildings.builds_dict['T']['cout']
        resources = self.game.compteur[self.player_id]['ressources']

        if (resources['W'] >= costs['Wood'] and
            resources['G'] >= costs['Gold'] and
            resources['f'] >= costs['Food']):
            # Find suitable position for building
            for x in range(self.game.size):
                for y in range(self.game.size):
                    if self.can_build_at((x, y)):
                        taille = self.game.buildings.builds_dict['T']['taille']
                        self.game.buildings.ajouter_batiment(
                            self.player_id, 'T', x, y, taille,
                            self.game.tiles, 1
                        )
                        return

    def can_build_at(self, pos):
        return pos in self.game.tiles and not self.game.tiles[pos].get('building')


